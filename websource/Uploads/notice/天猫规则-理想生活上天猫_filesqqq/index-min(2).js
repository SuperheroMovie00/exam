KISSY.config({packages:[{name:"market",path:"//assets.alicdn.com/p/market/r/120507/",charset:"utf-8"},{name:"gallery",path:"//assets.alicdn.com/s/kissy/",charset:"utf-8"}]}),KISSY.add("scrollspy",function(a){function b(a){this.init(a),this.refresh()}var c=a.all,d=a.one;return a.augment(b,{constructor:b,refresh:function(){this.targets=[],this.offsets=[],c(this.navSelector).each(function(a){var b=a.attr("href").replace(/\./g,"\\."),c=d(b);/^#\w/.test(b)&&c.length&&(this.targets.push(b),this.offsets.push(c.offset().top))},this),this.process()},process:function(){var b,c=a.DOM.scrollTop(document)+this.$scrollElement.scrollTop()+this.offset,d=this.offsets,e=this.targets,f=this.activeTarget;for(c+=70,b=d.length;b--;)f!=e[b]&&c>=d[b]&&(!d[b+1]||c<=d[b+1])&&this.activate(e[b])},activate:function(a){var b;this.activeTarget=a,b=c(".active",this.navContainer),b&&b.removeClass("active"),c(this.activerSelector+":[href="+a+"]").parent().addClass("active")},init:function(b){var d=b;this.offset=d.offset,this.navSelector=d.navSelector,this.navContainer=d.navContainer,this.activerSelector=d.activerSelector;var e=a.bind(this.process,this),f=c(d.scrollArea);this.$scrollElement=f.on("scroll",e),a.Event.on(document,"scroll",e)}}),b},{requires:["sizzle"]}),KISSY.add("init",function(a,b,c,d,e){function f(){var b,c=[];return a.all(".J_rule_node").each(function(d){var e,f=d.attr("data-type"),g=!1;"chapter"===f?(b="chapter",g=!0):"section"===f&&(b="section",g=!0),g&&c.push({type:f,text:e||a.trim(d.text()).replace(/\s+/g," "),id:d.attr("id")})}),c}function g(b){var c="";return a.each(b,function(b){c+="chapter"===b.type?a.substitute('<div class="dict-{type}"><i class=rule-current-line></i><i class="rule-dot"></i><a class="rule-node-item" target="_self" href="#{id}">{text}</a></div>',b):a.substitute('<div class="dict-{type}"><i class=rule-current-line></i><a class="rule-node-item" target="_self" href="#{id}">{text}</a></div>',b)}),c}function h(){if(!l){l=!0;var b=f(),e=g(b);if(a.all("#J_directory").html(e),k=new c(".directory-content",{prefix:"nice-",allowArrow:!1}),a.all(".rule-x-close").on("click",function(){a.all(".side-bar").removeClass("open-dict").removeClass("open-inner")}),8!==a.UA.ie){new d({offset:0,navContainer:".directory-wrap",activerSelector:".rule-node-item",scrollArea:".rules-content",navSelector:".rule-node-item"})}}}function i(){if("ruleLIst"in window){var b=ruleLIst;b&&a.each(b,function(b){var c=a.all("#"+b[0]);if(!c.length){var d=j(),e=d[b[0]];c=a.all("#"+e)}var f=c.last(".inner-break");f?f.append('<a href="'+b[1]+'?tag=self" class="help-icon" title="\u89e3\u91ca" target="_blank"></a>'):c.append('<a href="'+b[1]+'?tag=self" class="help-icon" title="\u89e3\u91ca" target="_blank"></a>')})}}function j(){function b(c){a.isArray(c)?a.each(c,b):(m[c.id]=c.uid,c.childrens&&b(c.childrens))}return m?m:(m={},b(ruleContent),m)}var k,l=!1;a.all(".rule-icon-brief").on("click",function(){if(!(a.UA.ie&&a.UA.ie<8)){{a.all(".side-bar").addClass("open-dict")}h()}});var m=null;i(),new e(".side-bar"),!function(){function b(a){var b=0,c=$("#J_SearchInput").val(),d=a+"?key="+encodeURIComponent(encodeURIComponent(c));d+="&pageIndex="+b,window.location.href=d}a.all("#J_SearchForm").on("submit",function(a){a.halt(),b(this.action)})}()},{requires:["node","gallery/kscroll/1.2/index","scrollspy","market/scrollFollow"]}),KISSY.use("init");